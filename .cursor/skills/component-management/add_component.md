name: add-component
description: Adds a component descriptor to the Architectural Reasoning Partner as a registered component rule.
version: 1.0.0

---

# ADD COMPONENT TO ARCHITECTURAL PARTNER

## Overview

This skill takes a component descriptor (generated by the `generate-component-descriptor` skill) and registers it as a component rule in this project. This allows the Architectural Reasoning Partner to include the component in its analysis.

---

## COMMAND: /add-component

### Usage

```
/add-component
[paste YAML descriptor here]
```

Or with a file reference:

```
/add-component from-file [path-to-descriptor.yaml]
```

---

## WORKFLOW

### Step 1: Parse the Component Descriptor

Extract the following from the provided YAML:
- `component.name` → Used for filename
- `component.domain` → Used for categorization
- `component.type` → Backend, frontend, mixed, etc.
- All other fields → Converted to rule format

### Step 2: Generate Rule File

Create a rule file at:
```
.cursor/rules/components/{component-name}.mdc
```

### Step 3: Update Component Registry

Update the component registry file:
```
.cursor/rules/components/_registry.mdc
```

### Step 4: Confirm Registration

Output confirmation with:
- File location
- Summary of component capabilities
- Trigger phrases that will now match this component

---

## RULE FILE TEMPLATE

Convert the descriptor to this rule format:

```markdown
# COMPONENT: {component.name}

## Overview
**Description:** {component.description}
**Domain:** {component.domain}
**Type:** {component.type}

## Guardians

### Main Guardians (Primary Owners)
{table of main guardians: name, email, role}

### Secondary Guardians (Backup/Contributors)
{table of secondary guardians: name, email, role - or "None" if empty}

## Technologies
{list technologies with stack_details}

## Ownership

### Entities Owned
{list entities with descriptions}

### Business Rules
{list business rules}

## APIs Exposed
{list APIs in table format}

## Event Integration

### Publishes
{list events published}

### Consumes
{list events consumed}

## Dependencies

### Calls (Outbound)
{list outbound dependencies}

### Called By (Inbound)
{list inbound dependencies}

## Trigger Phrases
When the specification mentions:
{list trigger phrases as bullets}

...this component should be considered for involvement.

## Implementation Notes
{list notes}

---
*Auto-generated from component descriptor. Last updated: {timestamp}*
```

---

## EXAMPLE TRANSFORMATION

### Input Descriptor (YAML)

```yaml
component:
  name: "payment-service"
  description: "Handles payment processing, refunds, and payment method management"
  domain: "Transaction & Financial"
  type: "backend-service"

guardians:
  main:
    - name: "John Smith"
      email: "john.smith@company.com"
      role: "Tech Lead"
  secondary:
    - name: "Jane Doe"
      email: "jane.doe@company.com"
      role: "Senior Developer"

technologies:
  primary: "Node.js/Express"
  stack_details:
    backend: "Node.js"
    database: "PostgreSQL"
    messaging: "Kafka"

owns:
  entities:
    - name: "Payment"
      description: "A payment transaction record"
      storage: "payments"
    - name: "PaymentMethod"
      description: "Stored payment methods for customers"
      storage: "payment_methods"

apis:
  rest:
    - method: "POST"
      path: "/api/payments"
      description: "Process a payment"
    - method: "POST"
      path: "/api/payments/{id}/refund"
      description: "Process a refund"

events:
  publishes:
    - name: "PaymentCompletedEvent"
      topic: "payments.completed"
  consumes:
    - name: "OrderCreatedEvent"
      topic: "orders.created"

trigger_phrases:
  - "process payment"
  - "payment method"
  - "refund"
```

### Output Rule File

**File:** `.cursor/rules/components/payment-service.mdc`

```markdown
# COMPONENT: payment-service

## Overview
**Description:** Handles payment processing, refunds, and payment method management
**Domain:** Transaction & Financial
**Type:** Backend Service

## Guardians

### Main Guardians (Primary Owners)
| Name | Email | Role |
|------|-------|------|
| John Smith | john.smith@company.com | Tech Lead |

### Secondary Guardians (Backup/Contributors)
| Name | Email | Role |
|------|-------|------|
| Jane Doe | jane.doe@company.com | Senior Developer |

## Technologies
| Layer | Technology |
|-------|------------|
| Backend | Node.js/Express |
| Database | PostgreSQL |
| Messaging | Kafka |

## Ownership

### Entities Owned
| Entity | Description | Storage |
|--------|-------------|---------|
| Payment | A payment transaction record | payments |
| PaymentMethod | Stored payment methods for customers | payment_methods |

### Business Rules
- Payment validation and processing
- Refund policy enforcement
- Payment method security

## APIs Exposed
| Method | Path | Description |
|--------|------|-------------|
| POST | /api/payments | Process a payment |
| POST | /api/payments/{id}/refund | Process a refund |

## Event Integration

### Publishes
| Event | Topic | Trigger |
|-------|-------|---------|
| PaymentCompletedEvent | payments.completed | When payment succeeds |

### Consumes
| Event | Topic | Action |
|-------|-------|--------|
| OrderCreatedEvent | orders.created | Initiates payment flow |

## Dependencies

### Calls (Outbound)
- None documented

### Called By (Inbound)
- order-service (for payment processing)
- web-app (for payment UI)

## Trigger Phrases
When the specification mentions:
- "process payment"
- "payment method"
- "refund"
- "charge"
- "billing"

...this component should be considered for involvement.

## Implementation Notes
- Uses Stripe as payment gateway
- PCI-compliant token handling

---
*Auto-generated from component descriptor. Last updated: 2024-01-15T10:30:00Z*
```

---

## REGISTRY UPDATE

After adding a component, update TWO registry files:

### 1. Component Registry (`.cursor/rules/components/_registry.mdc`)

```markdown
# Component Registry

## Registered Components

| Component | Domain | Type | Technologies | Main Guardian(s) | Last Updated |
|-----------|--------|------|--------------|------------------|--------------|
| payment-service | Transaction & Financial | Backend | Node.js | John Smith | 2024-01-15 |
| [new component] | [domain] | [type] | [tech] | [guardian] | [date] |
```

### 2. Guardians Registry (`.cursor/rules/components/_guardians.mdc`)

```markdown
# Guardians Registry

## By Component

### payment-service
**Main Guardians:**
| Name | Email | Role |
|------|-------|------|
| John Smith | john.smith@company.com | Tech Lead |

**Secondary Guardians:**
| Name | Email | Role |
|------|-------|------|
| Jane Doe | jane.doe@company.com | Senior Developer |

## By Person

### John Smith (john.smith@company.com)
**Main Guardian for:**
- payment-service (Tech Lead)

### Jane Doe (jane.doe@company.com)
**Secondary Guardian for:**
- payment-service (Senior Developer)
```

---

## MIXED-TECHNOLOGY COMPONENT HANDLING

For components with multiple technologies (monorepos, full-stack apps):

### Rule File Structure

```markdown
# COMPONENT: admin-dashboard (Mixed Technology)

## Overview
**Description:** Full-stack admin application
**Domain:** Frontend Experience
**Type:** Monorepo (Backend + Frontend)

## Technologies
| Layer | Technology | Path |
|-------|------------|------|
| Backend | Java/Spring | backend/ |
| Frontend | Angular | frontend/ |
| Database | PostgreSQL | - |

## Backend Portion (backend/)

### APIs Exposed
| Method | Path | Description |
|--------|------|-------------|
| GET | /api/admin/config | Get configuration |

### Events Published
| Event | Topic |
|-------|-------|
| ConfigUpdatedEvent | admin.config.updated |

## Frontend Portion (frontend/)

### Pages/Routes
| Route | Component | Description |
|-------|-----------|-------------|
| /admin/config | ConfigPage | Configuration management |
| /admin/monitoring | MonitoringDashboard | System monitoring |

### State Management
- Uses NgRx for global state
- WebSocket for real-time updates

## Trigger Phrases
When the specification mentions:
- "admin dashboard"
- "system configuration"
- "admin panel"
- Backend: "admin API", "config endpoint"
- Frontend: "admin UI", "config page"
```

---

## VALIDATION RULES

Before creating the rule file, validate:

1. **Required Fields:**
   - `component.name` (must be valid filename)
   - `component.description`
   - `component.domain`
   - `component.type`
   - `guardians.main` (at least 1 main guardian required)

2. **Guardian Validation:**
   - At least 1 main guardian is REQUIRED
   - Each guardian must have: name, email, role
   - Secondary guardians are optional (0 or more)

3. **Naming Convention:**
   - Component name should be lowercase with hyphens
   - No spaces or special characters

4. **Domain Validation:**
   - Must be one of the recognized domains or "Other"

5. **Duplicate Check:**
   - Check if component already exists in registry
   - If exists, ask whether to update or skip

---

## CONFIRMATION OUTPUT

After successful registration:

```markdown
## Component Registered Successfully

**Component:** payment-service
**File Created:** .cursor/rules/components/payment-service.mdc
**Registry Updated:** Yes
**Guardians Registry Updated:** Yes

### Summary
- **Domain:** Transaction & Financial
- **Type:** Backend Service
- **Technologies:** Node.js, PostgreSQL, Kafka
- **APIs:** 2 endpoints
- **Events:** 1 published, 1 consumed

### Guardians Registered
**Main (Primary Owners):**
- John Smith (john.smith@company.com) - Tech Lead

**Secondary (Backup/Contributors):**
- Jane Doe (jane.doe@company.com) - Senior Developer

### Trigger Phrases Registered
The following phrases will now match this component:
- "process payment"
- "payment method"
- "refund"

### Next Steps
1. Review the generated rule file for accuracy
2. Verify guardian information is correct
3. Add any missing trigger phrases
4. Run `/analyze-architecture` to test recognition
```

---

## BULK IMPORT

For importing multiple components at once:

```
/add-component bulk
[paste multiple YAML descriptors separated by ---]
```

Or from a directory:

```
/add-component bulk from-directory [path-to-descriptors/]
```
